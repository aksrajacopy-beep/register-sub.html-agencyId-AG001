<script>
  // URL se agencyId nikalna
  const params = new URLSearchParams(window.location.search);
  const parentAgencyId = params.get("agencyId");

  if (!parentAgencyId) {
    alert("Invalid registration link");
    throw new Error("Agency ID missing in URL");
  }

  function submitForm() {
    const name = document.getElementById("subAgencyName").value.trim();
    const owner = document.getElementById("ownerName").value.trim();
    const email = document.getElementById("email").value.trim();

    if (!name || !owner || !email) {
      alert("❌ Please fill all fields");
      return;
    }

    fetch("https://script.google.com/macros/s/AKfycbx-iPNbGzLZ-bFxlSbW0BWVMRuPPZc6CDJRYZKnjeAV2upzA2ylbK_iwMyP88HkQZwzmQ/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "subAgency",
        parentAgencyId: parentAgencyId,
        name: name,
        owner: owner,
        email: email
      })
    })
    .then(res => res.json())
    .then(res => {
      alert("✅ Sub-Agency Registered\nID: " + res.subAgencyId);
    })
    .catch(err => {
      console.error(err);
      alert("❌ Error! Try again");
    });
  }
</script>
